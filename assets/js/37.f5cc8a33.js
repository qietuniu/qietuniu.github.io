(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{540:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",[t._v("DNS是什么、DNS解析过程、DNS使用与优化")])]),t._v(" "),a("blockquote",[a("p",[t._v("重点掌握：\nDNS是什么、DNS解析过程、DNS使用与优化")])]),t._v(" "),a("h2",{attrs:{id:"基础概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础概念"}},[t._v("#")]),t._v(" 基础概念")]),t._v(" "),a("h4",{attrs:{id:"域名系统（domain-name-system，dns）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#域名系统（domain-name-system，dns）"}},[t._v("#")]),t._v(" 域名系统（Domain Name System，DNS）")]),t._v(" "),a("p",[t._v("这是互联网的一项服务，采用类似"),a("strong",[t._v("目录树")]),t._v("的等级结构，由"),a("strong",[t._v("域名解析器")]),t._v("和"),a("strong",[t._v("域名服务器")]),t._v("组成的。它作为将域名和IP地址相互映射的一个分布式数据库，提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务。")]),t._v(" "),a("p",[t._v("简而言之就是"),a("strong",[t._v("提供IP地址和域名之间互相转换的服务")]),t._v("。")]),t._v(" "),a("blockquote",[a("p",[t._v("处于应用层")])]),t._v(" "),a("h4",{attrs:{id:"域名解析器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#域名解析器"}},[t._v("#")]),t._v(" 域名解析器")]),t._v(" "),a("p",[t._v("把域名指向网站空间IP，让人们通过注册的域名可以方便地访问到网站的一种服务。")]),t._v(" "),a("h4",{attrs:{id:"域名服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#域名服务器"}},[t._v("#")]),t._v(" 域名服务器")]),t._v(" "),a("p",[t._v("保存有该网络中所有主机的域名和对应IP地址，并具有将域名转换为IP地址功能的服务器。域名服务器通常为客户机/服务器模式中的服务器方，它主要有两种形式："),a("strong",[t._v("主服务器")]),t._v("和"),a("strong",[t._v("转发服务器")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"ip与域名关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ip与域名关系"}},[t._v("#")]),t._v(" IP与域名关系")]),t._v(" "),a("ul",[a("li",[t._v("域名必须对应一个IP地址")]),t._v(" "),a("li",[t._v("一个IP地址可以有0至多个域名，而IP地址不一定有域名。")])]),t._v(" "),a("h3",{attrs:{id:"域名解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#域名解析"}},[t._v("#")]),t._v(" 域名解析")]),t._v(" "),a("p",[t._v("将域名映射为IP地址的过程就称为“域名解析”，简而言之就是"),a("strong",[t._v("在 DNS 上记录一条信息记录")]),t._v("。域名解析的发展分为三阶段：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("第一阶段是分布式的解析：解析工作由每一个主机负责。")]),t._v(" "),a("p",[t._v("指分在客户端上维护一个静态的文本文件，其中包含主机名和IP地址的映射。随着网络规模的扩大，分布式分辨率的有效性越来越低。")])]),t._v(" "),a("li",[a("p",[t._v("第二阶段集中式解析：由一台主机来完成的。")]),t._v(" "),a("p",[t._v("要求网络中有多台DNS服务器，负责维护域名/IP地址映射数据库。客户端从指定的服务器获取域名的地址信息。一旦客户端指定的DNS服务器不包含相应的数据，DNS服务器就会在网络中进行递归查询，并获取其他服务器上的地址信息。")])]),t._v(" "),a("li",[a("p",[t._v("目前阶段则是既有分布式的解析又有集中式解析，也就是服务器目前DNS。")])])]),t._v(" "),a("h3",{attrs:{id:"dns与tcp-udp的关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns与tcp-udp的关系"}},[t._v("#")]),t._v(" DNS与TCP/UDP的关系")]),t._v(" "),a("p",[t._v("DNS 协议建立在 UDP 或 TCP 协议之上，默认占用"),a("strong",[t._v("53")]),t._v("号端口，通讯的三种方式如下：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("UDP")])]),t._v(" "),a("p",[t._v("默认通过 UDP 协议进行通讯。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("TCP")])]),t._v(" "),a("p",[t._v("广域网中不适合传输过大的 UDP 数据包，当报文长度超过了 512 字节时，主动使用 TCP 协议进行数据传输。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("UDP+TCP")])]),t._v(" "),a("p",[t._v("客户端使用 UDP 协议发送 DNS 请求，服务端发现响应报文超过了 512 字节，在截断的 UDP 响应报文中将 TC 设置为 1 ，以通知客户端该报文已经被截断，客户端收到之后再发起一次 TCP 请求。")])])]),t._v(" "),a("blockquote",[a("p",[t._v("UDP为什么更快：不用经过TCP三次握手，这样DNS服务器负载更低，响应更快。")])]),t._v(" "),a("h3",{attrs:{id:"dns作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns作用"}},[t._v("#")]),t._v(" DNS作用")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("正向解析记录")]),t._v(" "),a("p",[t._v("通过域名找IP。浏览器并不能直接通过域名找到对应的服务器，而是要通过 IP 地址，但是域名更容易被人们所记住，所以通过域名解析将域名映射为IP地址。")])]),t._v(" "),a("li",[a("p",[t._v("反向解析记录")]),t._v(" "),a("p",[t._v("通过IP找域名，RTR反向解析。")])]),t._v(" "),a("li",[a("p",[t._v("提供主机别名服务")]),t._v(" "),a("p",[t._v("有着复杂主机名的主机可以有一个或者多个别名，例如aaa.xxx.com的主机可能还会有aaa.com和www.aaa.com两个别名，在这种情况下，aaa.xxx.com叫做规范主机名（canonical hostname）。主机别名的特征是比规范主机名更容易记忆，DNS可以提供根据主机别名获取规范主机名的服务。")])]),t._v(" "),a("li",[a("p",[t._v("负载均衡")]),t._v(" "),a("p",[t._v("一般来说，被繁忙访问的大型站点是分布在多台服务器上的， 这个时候，主机名和IP地址就不是一一对应的关系，而是一个主机名对应一个IP地址的集合。")]),t._v(" "),a("p",[t._v("在大量的，连续的多次访问中，DNS通过旋转IP地址达到负载均衡的目的：在向这个主机名发出DNS请求的时候，服务器会用包含全部这些IP地址的报文进行回答， 但在每个不同的回答中会旋转这些IP地址的摆放顺序，而客户机总向报文中排在最前的IP地址发出请求")])]),t._v(" "),a("li",[a("p",[t._v("CDN加速")]),t._v(" "),a("p",[t._v("对网页中的静态资源进行CDN节点缓存；在访问网页中的动态资源时从源站中调取，从而实现“动静分离”，达到加速的目的。“动静分离”的好处：用户访问网站时，静态资源直接从离自己最近的CDN节点缓存中获取，减少用户访问静态资源的时间，同时又降低源站服务器的带宽压力、静态资源访问压力。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("CDN静态加速：")]),t._v(" "),a("p",[t._v("对网页中的静态资源（包括html文件、CSS文件、js文件、图片、flash动画等）进行CDN节点缓存，使得用户在访问网页中的静态资源时，调取CDN边缘节点缓存。")])]),t._v(" "),a("li",[a("p",[t._v("CDN动态加速：")]),t._v(" "),a("p",[t._v("CDN的DNS解析中通过动态链路探测，监控网络环境的变化，监控各地网络延迟，寻找到一条最稳定、最高效、最快速的路径，回源动态资源，从而实现动态资源（如asp、php、jsp等）加速。然后构成链路列表，绑定到DNS解析上，更新到CDN的本地域名服务器上。")])])])])]),t._v(" "),a("h2",{attrs:{id:"整体架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整体架构"}},[t._v("#")]),t._v(" 整体架构")]),t._v(" "),a("p",[t._v('网址的解析是一个从右向左的过程，以www. baidu. com为例，“www. baidu. com”实际是“www. baidu. com. ” 这个  " .  "就是根域名服务器，默认情况下为了方便用户通常会省略。浏览器在请求DNS的时候会自动加上。')]),t._v(" "),a("p",[t._v("![架构](/img/browser/架构. png)")]),t._v(" "),a("h4",{attrs:{id:"根dns服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#根dns服务器"}},[t._v("#")]),t._v(" 根DNS服务器")]),t._v(" "),a("p",[t._v("掌握着所有顶级dns的ip和域名的对应关系，例如：.")]),t._v(" "),a("blockquote",[a("p",[t._v("因特网上有13个根DNS服务器， 其中大部分分布在北美洲")])]),t._v(" "),a("h4",{attrs:{id:"顶级dns服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#顶级dns服务器"}},[t._v("#")]),t._v(" 顶级DNS服务器")]),t._v(" "),a("p",[t._v("掌握着权威dns的ip和域名的对应关系。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("分类")]),t._v(" "),a("th",[t._v("域名")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("国家顶级域名")]),t._v(" "),a("td",[t._v("中国:cn， 美国:us，英国uk…")])]),t._v(" "),a("tr",[a("td",[t._v("通用顶级域名")]),t._v(" "),a("td",[t._v("com公司企业，edu教育机构，gov政府部门，int国际组织，mil军事部门 ，net网络，org非盈利组织…")])]),t._v(" "),a("tr",[a("td",[t._v("反向域名")]),t._v(" "),a("td",[t._v("arpa，用于PTR查询")])])])]),t._v(" "),a("h4",{attrs:{id:"权威dns服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#权威dns服务器"}},[t._v("#")]),t._v(" 权威DNS服务器")]),t._v(" "),a("p",[t._v("掌握着二级域名dns服务器的ip和域名的对应关系，例如：baidu. com。")]),t._v(" "),a("blockquote",[a("p",[t._v("在因特网上具有公共可访问的主机的每个组织机构必须提供公共可访问的DNS记录，这些记录将这些主机的名字映射为IP地址。 由组织机构的权威DNS服务器保存这些DNS记录，组织机构可以选择实现它自己的权威DNS服务器来保持这些记录，或者通过支付费用将这些记录存储在某个服务提供商的DNS服务器中。多数大学和大公司实现和维护它们自己基本的权威DNS服务器")])]),t._v(" "),a("h4",{attrs:{id:"二级域名的dns服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二级域名的dns服务器"}},[t._v("#")]),t._v(" 二级域名的DNS服务器")]),t._v(" "),a("p",[t._v("掌握着你要访问的域名和ip的对应关系，例如：www. baidu. com")]),t._v(" "),a("h4",{attrs:{id:"本地域名服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本地域名服务器"}},[t._v("#")]),t._v(" 本地域名服务器")]),t._v(" "),a("p",[t._v("主机发送DNS查询请求时，查询首先要通过本地域名服务器，其作用如下：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("代理转发：")]),t._v(" "),a("p",[t._v("主机和本地DNS服务器一般是相邻的，当主机发出DNS请求的时候，该请求会被发往本地DNS服务器，它起着代理的作用，并将该请求转发到DNS服务器层次结构中.")])]),t._v(" "),a("li",[a("p",[t._v("缓存：")]),t._v(" "),a("p",[t._v("本地DNS服务器可以通过缓存主机名/IP地址，减少对相同主机名的查询而消耗的时间，改善时延和性能.")])])]),t._v(" "),a("h2",{attrs:{id:"解析过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解析过程"}},[t._v("#")]),t._v(" 解析过程")]),t._v(" "),a("p",[t._v("![解析过程](/img/browser/解析流程. png)")]),t._v(" "),a("h3",{attrs:{id:"_1-浏览器缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-浏览器缓存"}},[t._v("#")]),t._v(" 1. 浏览器缓存")]),t._v(" "),a("p",[t._v("首先会向浏览器的缓存中查找是否有访问记录。")]),t._v(" "),a("blockquote",[a("p",[t._v("方法： 在chrome可以通过地址栏中输入chrome://net-internals/#dns查看缓存的当前状态")])]),t._v(" "),a("h3",{attrs:{id:"_2-操作系统缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-操作系统缓存"}},[t._v("#")]),t._v(" 2. 操作系统缓存")]),t._v(" "),a("p",[t._v("在系统运行中的内存里查找是否有缓存")]),t._v(" "),a("blockquote",[a("p",[t._v("方法：")]),t._v(" "),a("p",[t._v("在mac中:\n(1) 查看dns缓存：nslookup www. baidu. com\n(2) 清除系统中的DNS缓存：dscacheutil -flushcache")]),t._v(" "),a("p",[t._v("在windows中:\n(1) 查看dns缓存：ipconfig /displaydns\n(2) 强制更新缓存：ipconfig /flushdns")])]),t._v(" "),a("h3",{attrs:{id:"_3-host文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-host文件"}},[t._v("#")]),t._v(" 3. host文件")]),t._v(" "),a("p",[t._v("如果在缓存中查找不到，系统就会读取系统中预设的host文件")]),t._v(" "),a("blockquote",[a("p",[t._v("在windows中:\nhosts文件一般位于c:\\windows\\system32\\drivers\\etc")]),t._v(" "),a("p",[t._v("在mac中:\n(1) 打开finder\n(2) 快捷键组合Shift+Command+G，并在弹出框内输入/etc/hosts，回车即可看到hosts文件")])]),t._v(" "),a("h3",{attrs:{id:"_4-路由器缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-路由器缓存"}},[t._v("#")]),t._v(" 4. 路由器缓存")]),t._v(" "),a("p",[t._v("部分路由器有缓存功能，访问过的域名会存在路由器上。")]),t._v(" "),a("h3",{attrs:{id:"_5-isp-dns缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-isp-dns缓存"}},[t._v("#")]),t._v(" 5. ISP DNS缓存")]),t._v(" "),a("p",[t._v("ISP( Internet Service Provider )互联网服务提供商，例如：中国电信等也会提供DNS服务，比较有名的是114. 114. 114. 114。")]),t._v(" "),a("blockquote",[a("p",[t._v("在本地查找不到的情况下，就会向ISP进行查询，ISP会在当前服务器的缓存内查找是否有记录，如果有则返回这个IP，若没有则会开始向根域名服务器请求查询。")])]),t._v(" "),a("h3",{attrs:{id:"_6-顶级-根dns服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-顶级-根dns服务器"}},[t._v("#")]),t._v(" 6. 顶级/根DNS服务器")]),t._v(" "),a("p",[t._v("根域名收到请求后，会判别这个域名(. com)是授权给哪台服务器管理, 并返回这个顶级DNS服务器的IP。请求者收到这台顶级DNS的服务器IP后，会向该服务器发起查询，如果该服务器无法解析，该服务器就会返回下一级的DNS服务器IP（baidu. com），本机按照DNS架构继续查找，直到服务器找到(www. baidu. com)的主机。")]),t._v(" "),a("p",[t._v("可以通过dig命令查看域名解析的记录")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dig")]),t._v(" www.baidu.com\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" DiG "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9.10")]),t._v(".6 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" www.baidu.com\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" global options: +cmd\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" Got answer:\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" -"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("HEADER"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<-")]),t._v(" opcode: QUERY, status: NOERROR, id: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("46850")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" flags: qr rd ra ad"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" QUERY: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", ANSWER: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(", AUTHORITY: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(", ADDITIONAL: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" QUESTION SECTION:\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("www.baidu.com.\t\t\tIN\tA\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" ANSWER SECTION:\nwww.baidu.com.\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("98")]),t._v("\tIN\tA\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("163.177")]),t._v(".151.109\nwww.baidu.com.\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("98")]),t._v("\tIN\tA\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("163.177")]),t._v(".151.110\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" Query time: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" msec\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" SERVER: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.1"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#53(192.168.1.1)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" WHEN: Tue Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":51:36 CST "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" MSG SIZE  rcvd: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("63")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br")])]),a("blockquote",[a("p",[t._v("第一部分：显示 dig 命令的版本和输入的参数。")]),t._v(" "),a("p",[t._v("第二部分：显示服务返回的一些技术详情，当status 的值为 NOERROR 则说明本次查询成功结束。")]),t._v(" "),a("p",[t._v('第三部分： "QUESTION SECTION" 显示我们要查询的域名。')]),t._v(" "),a("p",[t._v('第四部分： "ANSWER SECTION" 是查询到的结果，返回该网址的2个IP。98为TTL的值，表示该域名的缓存时间，即该时间内不用重新查询。A是该DNS查询的记录类型，表示返回一个IPv4格式的地址。还有其他记录类型诸如 NS（返回查询的服务器地址）、AAAA（返回IPV6格式的地址）、CNAME（域名的别名）等')]),t._v(" "),a("ul",[a("li",[t._v("NS 记录（域名服务） ─ 指定解析域名或子域名的 DNS 服务器。")]),t._v(" "),a("li",[t._v("MX 记录（邮件交换） ─ 指定接收信息的邮件服务器。")]),t._v(" "),a("li",[t._v("A 记录（地址） ─ 指定域名对应的 IPv4 地址记录。")]),t._v(" "),a("li",[t._v("AAAA 记录（地址） ─ 指定域名对应的 IPv6 地址记录。")]),t._v(" "),a("li",[t._v("NAME（规范） ─ 一个域名映射到另一个域名或 CNAME 记录（ baidu. com 指向 www. baidu. com ）或映射到一个 A记录。")]),t._v(" "),a("li",[t._v("PTR 记录（反向记录） ─ PTR 记录用于定义与 IP 地址相关联的名称。 PTR 记录是 A 或 AAAA 记录的逆。 PTR 记录是唯一的，因为它们以 . arpa 根开始并被委派给 IP 地址的所有者")])]),t._v(" "),a("p",[t._v("第五部分：本次查询的一些统计信息，Query time用了多长时间，SERVER查询了哪个 DNS 服务器，WHEN在什么时间进行的查询，MSG SIZE信息大小。")])]),t._v(" "),a("h3",{attrs:{id:"_7-缓存并返回结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-缓存并返回结果"}},[t._v("#")]),t._v(" 7. 缓存并返回结果")]),t._v(" "),a("p",[t._v("查找到目标ip后返回给本地DNS，本地DNS缓存该域名和相应id后将解析结果返回给用户，并缓存在操作系统中。域名解析过程至此结束")]),t._v(" "),a("h2",{attrs:{id:"查询方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询方式"}},[t._v("#")]),t._v(" 查询方式")]),t._v(" "),a("p",[t._v("![解析过程](/img/browser/查询方式. png)")]),t._v(" "),a("h3",{attrs:{id:"递归查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#递归查询"}},[t._v("#")]),t._v(" 递归查询")]),t._v(" "),a("p",[t._v("递归查询是一种DNS 服务器的查询模式，在该模式下DNS 服务器接收到客户机请求，必须使用一个准确的查询结果回复客户机。")]),t._v(" "),a("p",[t._v("如果DNS 服务器本地没有存储查询DNS信息，那么本地服务器就会成为DNS中的一台客户机，并向上级域名服务器发出查询请求，这种过程将持续到找到具有相关信息的域名服务器为止，然后将返回的查询结果提交给客户机。过程中如果没有找到查询结果，重复递归上述操作直至根域名服务器，根域名服务器收到DNS请求后，把所查询得到的所请求的DNS域名中发送给顶级域名服务器，让顶级域名服务器去往下级域名服务器请求查找，如果找到了就原路返回。")]),t._v(" "),a("p",[t._v("某域名服务器--\x3e... ->顶级域名服务器--\x3e根域名服务器--\x3e下一级域名服务器--\x3e... --\x3e本地域名服务器--\x3e客户机。如果没有找到就报错，表示无法查询到相关信息。")]),t._v(" "),a("h3",{attrs:{id:"迭代查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#迭代查询"}},[t._v("#")]),t._v(" 迭代查询")]),t._v(" "),a("p",[t._v("DNS 服务器会向客户机提供其他能够解析查询请求的DNS 服务器地址，当客户机发送查询请求时，DNS 服务器并不直接回复查询结果，而是告诉客户机另一台DNS 服务器地址，客户机再向这台DNS 服务器提交请求，依次循环直到返回查询的结果为止。迭代解析只是帮你找到相关的服务器而已，而不会帮你去查。")]),t._v(" "),a("h3",{attrs:{id:"递归查询和迭代查询的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#递归查询和迭代查询的区别"}},[t._v("#")]),t._v(" 递归查询和迭代查询的区别")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("区别点/查询方式")]),t._v(" "),a("th",[t._v("递归查询")]),t._v(" "),a("th",[t._v("迭代查询")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("工作方式")]),t._v(" "),a("td",[t._v("该DNS服务器按照DNS结构逐级查找结果")]),t._v(" "),a("td",[t._v("该DNS服务器找到相关服务器，让相关的服务器去查询结果")])]),t._v(" "),a("tr",[a("td",[t._v("使用场景")]),t._v(" "),a("td",[t._v("从请求主机到本地DNS服务器的查询，一般发生在客户端与服务器间")]),t._v(" "),a("td",[t._v("根域名服务器")])]),t._v(" "),a("tr",[a("td",[t._v("查询状态")]),t._v(" "),a("td",[t._v("在域名服务器查询期间，客户机将完全处于等待状态")]),t._v(" "),a("td",[t._v("直到服务器给出的提示中包含所需要查询的主机地址为止")])])])]),t._v(" "),a("h2",{attrs:{id:"预加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预加载"}},[t._v("#")]),t._v(" 预加载")]),t._v(" "),a("p",[t._v("通过使用预加载来缓解页面加载压力。DNS预解析实现预先域名解析的功能，加速服务器域名，调用资源直接通过解析后的 IP 不需要再进行 DNS 解析。")]),t._v(" "),a("h3",{attrs:{id:"dns-预解析-dns-prefetch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns-预解析-dns-prefetch"}},[t._v("#")]),t._v(" DNS 预解析 dns-prefetch")]),t._v(" "),a("p",[t._v("通过指定具体的URL来告知客户端未来会用到相关的资源，这样浏览器可以尽早的解析DNS。现代浏览器帮我们做了很多，比如"),a("a",{attrs:{href:"https://www.chromium.org/developers/design-documents/dns-prefetching",target:"_blank",rel:"noopener noreferrer"}},[t._v("谷歌"),a("OutboundLink")],1),t._v("其实默认会对页面里已有的超链接做DNS预解析，我们DNS预解析的使用场景为预判：")]),t._v(" "),a("ul",[a("li",[t._v("js可能发起的请求或跳转")]),t._v(" "),a("li",[t._v("用户可能重定向访问的页面")]),t._v(" "),a("li",[t._v("当静态资源和HTML不在一个域上，而在CDN上")]),t._v(" "),a("li",[t._v("超链接不用做，因为chrome或自动做dns prefetch")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 打开和关闭DNS预读取，X-DNS-Prefetch-Control头控制着浏览器的DNS预解析功能")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("\nmeta http "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" equiv "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"x-dns-prefetch-control"')]),t._v("\ncontent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"off"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 强制查询特定主机名")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("\n    link rel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dns-prefetch"')]),t._v("\nhref "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://www.baidu.com"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("blockquote",[a("p",[t._v("dns-prefetch需慎用，多页面重复DNS预解析会增加重复DNS查询次数")]),t._v(" "),a("p",[t._v("浏览器支持：")]),t._v(" "),a("p",[t._v("– Safari: 5+")]),t._v(" "),a("p",[t._v("– Chrome: All")]),t._v(" "),a("p",[t._v("– Firefox: 3. 5+")]),t._v(" "),a("p",[t._v("– Opera: Unknown")]),t._v(" "),a("p",[t._v("– IE: 9+ (called “Pre-resolution” on blogs. msdn. com)")])]),t._v(" "),a("h4",{attrs:{id:"dns预解析一般方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns预解析一般方案"}},[t._v("#")]),t._v(" DNS预解析一般方案")]),t._v(" "),a("p",[t._v("普通页面进行预加载的通用方案")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token doctype"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),a("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("x-dns-prefetch-control"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dns-prefetch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/javascript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    max "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    preloadJs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'js文件路径'")]),t._v("，\n                        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" max "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" preloadJs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" max"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" preloadJs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br")])]),a("h3",{attrs:{id:"预连接-preconnect"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预连接-preconnect"}},[t._v("#")]),t._v(" 预连接 preconnect")]),t._v(" "),a("p",[t._v("与DNS prefetch类似，preconnect不光会解析DNS，还会建立TCP握手连接和TLS协议(https时)，也就意味着存在更多开销，时间更慢。可以预先建立 socket 连接，从而消除昂贵的 DNS 查找、TCP 握手和 TLS 往返开销。")]),t._v(" "),a("p",[t._v("preconnect会占用CPU资源，如果该域名在10s内不会被使用到，不应该使用preconnect不需要缓存的请求数据，我们可以尝试实现preconnect")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" link rel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"preconnect"')]),t._v("\nhref "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://www.baidu.com"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h3",{attrs:{id:"prefetch-preload"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prefetch-preload"}},[t._v("#")]),t._v(" prefetch/preload")]),t._v(" "),a("p",[t._v("我们会在页面中使用 "),a("code",[t._v("<link rel= preload >")]),t._v(" & "),a("code",[t._v("<link rel= prefetch >")]),t._v(" 来进行预加载。Webpack 4. 6. 0为我们提供了预先拉取（prefetching）和预先加载（preloading）的功能。使用这些声明可以修改浏览器处理异步chunk的方式。")]),t._v(" "),a("h4",{attrs:{id:"prefetch预先拉取"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prefetch预先拉取"}},[t._v("#")]),t._v(" prefetch预先拉取")]),t._v(" "),a("p",[t._v("使用预先拉取，你表示该模块可能以后会用到。prefetch在浏览器会在空闲时间下载该模块，且下载是发生在父级chunk加载完成之后。预获取对 webfonts 性能提升非常明显。")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("./util/common")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" \n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* webpackPrefetch: true */")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/* webpackChunkName: "util" */')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[t._v("以上的导入会让 "),a("code",[t._v('<link rel="prefetch" as="script" href="common.js">')]),t._v(" 被添加至页面的头部。因此浏览器会在空闲时间预先拉取该文件。")]),t._v(" "),a("h4",{attrs:{id:"preload预先加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preload预先加载"}},[t._v("#")]),t._v(" preload预先加载")]),t._v(" "),a("p",[t._v("在资源上添加预先加载的注释，你指明该模块需要立即被使用。异步chunk会和父级chunk并行加载。如果父级chunk先下载好，页面就已可显示了，同时等待异步chunk的下载。当这能大幅提升性能。")]),t._v(" "),a("p",[t._v("Preload用于更早地发现资源并避免发起类似瀑布一样的请求。 它可以将页面加载降低到2次往返（1. HTML，2。所有其他资源），使用它不会花费额外的带宽。")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("./util/common")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" \n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* webpackPreload: true */")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/* webpackChunkName: "util" */')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("以上代码的效果是让 "),a("code",[t._v('<link rel="preload" as="script" href="common.js">')]),t._v(" 起作用。不当地使用wepback的Preload会损害性能，所以使用的时候要小心。")]),t._v(" "),a("h4",{attrs:{id:"去除内置prefetch-preload"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#去除内置prefetch-preload"}},[t._v("#")]),t._v(" 去除内置prefetch/preload")]),t._v(" "),a("p",[t._v("webpack打包中会加入带有preload/preload的资源，使用该代码可以去除")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chainWebpack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'preload'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'prefetch'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h4",{attrs:{id:"preload和prefetch区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preload和prefetch区别"}},[t._v("#")]),t._v(" preload和prefetch区别")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("preload块与父块并行加载。prefetch块会在父块加载结束后开始加载。")])]),t._v(" "),a("li",[a("p",[t._v("preload块具有中等优先级，并立即下载。prefetch块在浏览器闲置时下载")])]),t._v(" "),a("li",[a("p",[t._v("preload块会在父块中立即请求，用于当下时刻。prefetch块会用于未来的某个时刻")])]),t._v(" "),a("li",[a("p",[t._v("浏览器支持程度不同，preload支持情况约为50%，prefetch支持情况约为71%")])])]),t._v(" "),a("h4",{attrs:{id:"preload和prefetch缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preload和prefetch缺点"}},[t._v("#")]),t._v(" preload和prefetch缺点")]),t._v(" "),a("p",[t._v("在资源没有缓存的情况下使用 preload 或 prefetch，会造成用户带宽的浪费。未用到的 preload 资源在 Chrome 的 console 里会在 onload 事件 3s 后发生警告。")]),t._v(" "),a("h2",{attrs:{id:"优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化"}},[t._v("#")]),t._v(" 优化")]),t._v(" "),a("p",[t._v("DNS解析是很耗时，当解析域名过多时会让首屏加载变得过慢。优化的方法就是减少DNS查询。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("合理减少页面的唯一域名")]),t._v(" "),a("p",[t._v("每次 DNS 查询就是查找唯一域名的过程，那么域名越少，DNS 查询就越少，应该尽量将资源放在同一域名。")])]),t._v(" "),a("li",[a("p",[t._v("dns-prefetch")]),t._v(" "),a("p",[t._v("让浏览器空闲时提前解析dns域名。当静态资源和HTML不在一个域上而在CDN上时，或者在重定向前可使用该方法。")])])]),t._v(" "),a("h3",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"%5BLICENSE%5D(https://blog.csdn.net/john1337/article/details/82991472)"}},[t._v("浅析DNS域名解析过程")])]),t._v(" "),a("li",[a("a",{attrs:{href:"%5BLICENSE%5D(https://segmentfault.com/a/1190000018828048)"}},[t._v("Web 性能优化：Preload, Prefetch的使用及在 Chrome 中的优先级")])])]),t._v(" "),a("blockquote",[a("p",[t._v("预加载小结待完善。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);